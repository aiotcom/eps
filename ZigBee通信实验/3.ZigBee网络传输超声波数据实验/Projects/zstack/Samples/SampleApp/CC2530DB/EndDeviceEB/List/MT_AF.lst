###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         16/Dec/2020  21:43:17 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Components\mt\MT_AF.c                  #
#    Command line       =  -f E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä #
#                          ³¬Éù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\C #
#                          C2530DB\..\..\..\Tools\CC2530DB\f8wEndev.cfg       #
#                          (-DCPU32MHZ -DROOT=__near_func -DBLINK_LEDS) -f    #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg         #
#                          (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR      #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFF11                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Components\mt\MT_AF.c -D               #
#                          NWK_AUTO_POLL -D ZTOOL_P1 -D MT_SYS_FUNC -D        #
#                          MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG -lC             #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\EndDeviceEB\List\ -lA                         #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\EndDeviceEB\List\ --diag_suppress             #
#                          Pe001,Pa010 -o E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.Zi #
#                          gBeeÍøÂç´«Êä³¬Éù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples #
#                          \SampleApp\CC2530DB\EndDeviceEB\Obj\ -e            #
#                          --no_unroll --no_inline --no_tbaa --debug          #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅ #
#                          ÊµÑé\3.ZigBeeÍøÂç´«Êä³¬Éù²¨Êý¾ÝÊµÑé\Projects\zstac #
#                          k\Samples\SampleApp\CC2530DB\ -I                   #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\SOURCE\ -I E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\ #
#                          3.ZigBeeÍøÂç´«Êä³¬Éù²¨Êý¾ÝÊµÑé\Projects\zstack\Sam #
#                          ples\SampleApp\CC2530DB\..\..\..\ZMAIN\TI2530DB\   #
#                          -I E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä #
#                          ³¬Éù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\C #
#                          C2530DB\..\..\..\..\..\COMPONENTS\MT\ -I           #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE\ -I     #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\CC2530EB #
#                          \ -I E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´« #
#                          Êä³¬Éù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp #
#                          \CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\CCSOC #
#                          \ -I E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´« #
#                          Êä³¬Éù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp #
#                          \CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\INCLUDE\  #
#                          -I E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä #
#                          ³¬Éù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\C #
#                          C2530DB\..\..\..\..\..\COMPONENTS\STACK\AF\ -I     #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\STACK\NWK\ -I       #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\STACK\SEC\ -I       #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\STACK\SAPI\ -I      #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\STACK\SYS\ -I       #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\ -I       #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W\ -I        #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\ZMAC\ -I            #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\SERVICES\SADDR\ -I  #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\SERVICES\SDATA\ -I  #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\MAC\INCLUDE\ -I     #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_LEVEL\ -I  #
#                          E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04 #
#                          \ -I E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´« #
#                          Êä³¬Éù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp #
#                          \CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\ #
#                          srf04\SINGLE_CHIP\ -I E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµ #
#                          Ñé\3.ZigBeeÍøÂç´«Êä³¬Éù²¨Êý¾ÝÊµÑé\Projects\zstack\ #
#                          Samples\SampleApp\CC2530DB\..\..\..\..\..\COMPONEN #
#                          TS\HARDWARE\ -Om                                   #
#    List file          =  E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\EndDeviceEB\List\MT_AF.lst                    #
#    Object file        =  E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬É #
#                          ù²¨Êý¾ÝÊµÑé\Projects\zstack\Samples\SampleApp\CC25 #
#                          30DB\EndDeviceEB\Obj\MT_AF.r51                     #
#                                                                             #
#                                                                             #
###############################################################################

E:\³£ÓÃÄ£¿éÊµÑé\ZigBeeÍ¨ÐÅÊµÑé\3.ZigBeeÍøÂç´«Êä³¬Éù²¨Êý¾ÝÊµÑé\Components\mt\MT_AF.c
      1          /**************************************************************************************************
      2            Filename:       MT_AF.c
      3            Revised:        $Date: 2010-01-08 16:52:37 -0800 (Fri, 08 Jan 2010) $
      4            Revision:       $Revision: 21471 $
      5          
      6          
      7            Description:    MonitorTest functions for the AF layer.
      8          
      9          
     10            Copyright 2007-2010 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          
     40          **************************************************************************************************/
     41          
     42          /***************************************************************************************************
     43           * INCLUDES
     44           ***************************************************************************************************/
     45          #include "ZComDef.h"
     46          #include "OSAL.h"
     47          #include "MT.h"
     48          #include "MT_AF.h"
     49          #include "MT_ZDO.h"
     50          #include "nwk.h"
     51          #include "OnBoard.h"
     52          #include "MT_UART.h"
     53          
     54          #if defined INTER_PAN
     55          #include "stub_aps.h"
     56          #endif
     57          
     58          /***************************************************************************************************
     59           * GLOBAL VARIABLES
     60           ***************************************************************************************************/
     61          
     62          #if defined ( MT_AF_CB_FUNC )
     63          uint16 _afCallbackSub;
     64          #endif
     65          
     66          /***************************************************************************************************
     67           * LOCAL FUNCTIONS
     68           ***************************************************************************************************/
     69          void MT_AfRegister(uint8 *pBuf);
     70          void MT_AfDataRequest(uint8 *pBuf);
     71          
     72          #if defined ( ZIGBEE_SOURCE_ROUTING )
     73          void MT_AfDataRequestSrcRtg(uint8 *pBuf);
     74          #endif
     75          
     76          #if defined INTER_PAN
     77          static void MT_AfInterPanCtl(uint8 *pBuf);
     78          #endif
     79          
     80          /***************************************************************************************************
     81           * @fn      MT_afCommandProcessing
     82           *
     83           * @brief   Process all the AF commands that are issued by test tool
     84           *
     85           * @param   pBuf - pointer to the received buffer
     86           *
     87           * @return  status
     88           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     89          uint8 MT_AfCommandProcessing(uint8 *pBuf)
   \                     MT_AfCommandProcessing:
     90          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
     91            uint8 status = MT_RPC_SUCCESS;
   \   000005   7E00         MOV     R6,#0x0
     92          
     93            switch (pBuf[MT_RPC_POS_CMD1])
   \   000007   8A82         MOV     DPL,R2
   \   000009   8B83         MOV     DPH,R3
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6008         JZ      ??MT_AfCommandProcessing_0
   \   000010   14           DEC     A
   \   000011   600A         JZ      ??MT_AfCommandProcessing_1
   \   000013   14           DEC     A
   \   000014   6007         JZ      ??MT_AfCommandProcessing_1
   \   000016   800A         SJMP    ??MT_AfCommandProcessing_2
     94            {
     95              case MT_AF_REGISTER:
     96                MT_AfRegister(pBuf);
   \                     ??MT_AfCommandProcessing_0:
   \   000018                ; Setup parameters for call to function MT_AfRegister
   \   000018   12....       LCALL   ??MT_AfRegister?relay
     97                break;
   \   00001B   8007         SJMP    ??MT_AfCommandProcessing_3
     98          
     99              case MT_AF_DATA_REQUEST:
    100              case MT_AF_DATA_REQUEST_EXT:
    101                MT_AfDataRequest(pBuf);
   \                     ??MT_AfCommandProcessing_1:
   \   00001D                ; Setup parameters for call to function MT_AfDataRequest
   \   00001D   12....       LCALL   ??MT_AfDataRequest?relay
    102                break;
   \   000020   8002         SJMP    ??MT_AfCommandProcessing_3
    103                
    104          #if defined ( ZIGBEE_SOURCE_ROUTING )
    105              case MT_AF_DATA_REQUEST_SRCRTG:
    106                MT_AfDataRequestSrcRtg(pBuf);
    107                break;
    108          #endif
    109                
    110          #if defined INTER_PAN
    111              case MT_AF_INTER_PAN_CTL:
    112                MT_AfInterPanCtl(pBuf);
    113                break; 
    114          #endif
    115                
    116              default:
    117                status = MT_RPC_ERR_COMMAND_ID;
   \                     ??MT_AfCommandProcessing_2:
   \   000022   0E           INC     R6
   \   000023   0E           INC     R6
    118                break;
    119            }
    120          
    121            return status;
   \                     ??MT_AfCommandProcessing_3:
   \   000024   EE           MOV     A,R6
   \   000025   F9           MOV     R1,A
   \   000026   7F01         MOV     R7,#0x1
   \   000028   02....       LJMP    ?BANKED_LEAVE_XDATA
    122          }
    123          
    124          /***************************************************************************************************
    125           * @fn      MT_AfRegister
    126           *
    127           * @brief   Process AF Register command
    128           *
    129           * @param   pBuf - pointer to the received buffer
    130           *
    131           * @return  none
    132           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    133          void MT_AfRegister(uint8 *pBuf)
   \                     MT_AfRegister:
    134          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
    135            uint8 cmdId;
    136            uint8 retValue = ZMemError;
   \   00000E   85..82       MOV     DPL,?XSP + 0
   \   000011   85..83       MOV     DPH,?XSP + 1
   \   000014   7410         MOV     A,#0x10
   \   000016   F0           MOVX    @DPTR,A
    137            endPointDesc_t *epDesc;
    138          
    139            /* parse header */
    140            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   000017   8A82         MOV     DPL,R2
   \   000019   8B83         MOV     DPH,R3
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F5..         MOV     ?V0 + 2,A
    141            pBuf += MT_RPC_FRAME_HDR_SZ;
    142          
    143            epDesc = (endPointDesc_t *)osal_mem_alloc(sizeof(endPointDesc_t));
   \   000020                ; Setup parameters for call to function osal_mem_alloc
   \   000020   7A06         MOV     R2,#0x6
   \   000022   7B00         MOV     R3,#0x0
   \   000024   12....       LCALL   ??osal_mem_alloc?relay
   \   000027   8A..         MOV     ?V0 + 4,R2
   \   000029   8B..         MOV     ?V0 + 5,R3
   \   00002B   AE..         MOV     R6,?V0 + 4
   \   00002D   AF..         MOV     R7,?V0 + 5
    144            if ( epDesc )
   \   00002F   EE           MOV     A,R6
   \   000030   4F           ORL     A,R7
   \   000031   6041         JZ      ??MT_AfRegister_0
    145            {
    146              epDesc->task_id = &MT_TaskID;
   \   000033   8E82         MOV     DPL,R6
   \   000035   8F83         MOV     DPH,R7
   \   000037   A3           INC     DPTR
   \   000038   74..         MOV     A,#MT_TaskID & 0xff
   \   00003A   F0           MOVX    @DPTR,A
   \   00003B   A3           INC     DPTR
   \   00003C   74..         MOV     A,#(MT_TaskID >> 8) & 0xff
   \   00003E   F0           MOVX    @DPTR,A
    147              retValue = MT_BuildEndpointDesc( pBuf, epDesc );
   \   00003F                ; Setup parameters for call to function MT_BuildEndpointDesc
   \   00003F   EE           MOV     A,R6
   \   000040   FC           MOV     R4,A
   \   000041   EF           MOV     A,R7
   \   000042   FD           MOV     R5,A
   \   000043   E5..         MOV     A,?V0 + 0
   \   000045   2403         ADD     A,#0x3
   \   000047   FA           MOV     R2,A
   \   000048   E5..         MOV     A,?V0 + 1
   \   00004A   3400         ADDC    A,#0x0
   \   00004C   FB           MOV     R3,A
   \   00004D   12....       LCALL   ??MT_BuildEndpointDesc?relay
   \   000050   E9           MOV     A,R1
   \   000051   85..82       MOV     DPL,?XSP + 0
   \   000054   85..83       MOV     DPH,?XSP + 1
   \   000057   F0           MOVX    @DPTR,A
    148              if ( retValue == ZSuccess )
   \   000058   E0           MOVX    A,@DPTR
   \   000059   700F         JNZ     ??MT_AfRegister_1
    149              {
    150                retValue = afRegister( epDesc );
   \   00005B                ; Setup parameters for call to function afRegister
   \   00005B   EE           MOV     A,R6
   \   00005C   FA           MOV     R2,A
   \   00005D   EF           MOV     A,R7
   \   00005E   FB           MOV     R3,A
   \   00005F   12....       LCALL   ??afRegister?relay
   \   000062   E9           MOV     A,R1
   \   000063   85..82       MOV     DPL,?XSP + 0
   \   000066   85..83       MOV     DPH,?XSP + 1
   \   000069   F0           MOVX    @DPTR,A
    151              }
    152          
    153              if ( retValue != ZSuccess )
   \                     ??MT_AfRegister_1:
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   6007         JZ      ??MT_AfRegister_0
    154              {
    155                osal_mem_free( epDesc );
   \   00006D                ; Setup parameters for call to function osal_mem_free
   \   00006D   EE           MOV     A,R6
   \   00006E   FA           MOV     R2,A
   \   00006F   EF           MOV     A,R7
   \   000070   FB           MOV     R3,A
   \   000071   12....       LCALL   ??osal_mem_free?relay
    156              }
    157            }
    158          
    159            /* Build and send back the response */
    160            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmdId, 1, &retValue);
   \                     ??MT_AfRegister_0:
   \   000074                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000074   85..82       MOV     DPL,?XSP + 0
   \   000077   85..83       MOV     DPH,?XSP + 1
   \   00007A   AC82         MOV     R4,DPL
   \   00007C   AD83         MOV     R5,DPH
   \   00007E   7B01         MOV     R3,#0x1
   \   000080   AA..         MOV     R2,?V0 + 2
   \   000082   7964         MOV     R1,#0x64
   \   000084   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    161          }
   \   000087   7401         MOV     A,#0x1
   \   000089   12....       LCALL   ?DEALLOC_XSTACK8
   \   00008C   7F06         MOV     R7,#0x6
   \   00008E   02....       LJMP    ?BANKED_LEAVE_XDATA
    162          
    163          /***************************************************************************************************
    164           * @fn      MT_AfDataRequest
    165           *
    166           * @brief   Process AF Register command
    167           *
    168           * @param   pBuf - pointer to the received buffer
    169           *
    170           * @return  none
    171           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    172          void MT_AfDataRequest(uint8 *pBuf)
   \                     MT_AfDataRequest:
    173          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    174            uint8 cmd0, cmd1, tempLen = 0;
    175            uint8 retValue = ZFailure;
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   7401         MOV     A,#0x1
   \   000012   F0           MOVX    @DPTR,A
    176            endPointDesc_t *epDesc;
    177            byte transId;
    178            afAddrType_t dstAddr;
    179            cId_t cId;
    180            byte txOpts, radius, srcEP;
    181          
    182            /* Parse header */
    183            cmd0 = pBuf[MT_RPC_POS_CMD0];
   \   000013   8A82         MOV     DPL,R2
   \   000015   8B83         MOV     DPH,R3
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   FF           MOV     R7,A
    184            cmd1 = pBuf[MT_RPC_POS_CMD1];
   \   00001A   8A82         MOV     DPL,R2
   \   00001C   8B83         MOV     DPH,R3
   \   00001E   A3           INC     DPTR
   \   00001F   A3           INC     DPTR
   \   000020   E0           MOVX    A,@DPTR
   \   000021   FE           MOV     R6,A
    185            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000022   EA           MOV     A,R2
   \   000023   2403         ADD     A,#0x3
   \   000025   F5..         MOV     ?V0 + 4,A
   \   000027   EB           MOV     A,R3
   \   000028   3400         ADDC    A,#0x0
   \   00002A   F5..         MOV     ?V0 + 5,A
    186          
    187            if (cmd1 == MT_AF_DATA_REQUEST_EXT)
   \   00002C   85..82       MOV     DPL,?V0 + 4
   \   00002F   F583         MOV     DPH,A
   \   000031   A3           INC     DPTR
   \   000032   8582..       MOV     ?V0 + 0,DPL
   \   000035   8583..       MOV     ?V0 + 1,DPH
   \   000038   7402         MOV     A,#0x2
   \   00003A   6E           XRL     A,R6
   \   00003B   6003         JZ      $+5
   \   00003D   02....       LJMP    ??MT_AfDataRequest_0 & 0xFFFF
    188            {
    189              dstAddr.addrMode = (afAddrMode_t)*pBuf++;
   \   000040   85..82       MOV     DPL,?V0 + 4
   \   000043   85..83       MOV     DPH,?V0 + 5
   \   000046   E0           MOVX    A,@DPTR
   \   000047   F8           MOV     R0,A
   \   000048   C0E0         PUSH    A
   \   00004A   740A         MOV     A,#0xa
   \   00004C   12....       LCALL   ?XSTACK_DISP0_8
   \   00004F   D0E0         POP     A
   \   000051   F0           MOVX    @DPTR,A
   \   000052   85....       MOV     ?V0 + 4,?V0 + 0
   \   000055   85....       MOV     ?V0 + 5,?V0 + 1
    190          
    191              if (dstAddr.addrMode == afAddr64Bit)
   \   000058   7403         MOV     A,#0x3
   \   00005A   68           XRL     A,R0
   \   00005B   701F         JNZ     ??MT_AfDataRequest_1
    192              {
    193                (void)osal_memcpy(dstAddr.addr.extAddr, pBuf, Z_EXTADDR_LEN);
   \   00005D                ; Setup parameters for call to function osal_memcpy
   \   00005D   75..00       MOV     ?V0 + 2,#0x0
   \   000060   78..         MOV     R0,#?V0 + 0
   \   000062   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000065   7C08         MOV     R4,#0x8
   \   000067   7D00         MOV     R5,#0x0
   \   000069   7405         MOV     A,#0x5
   \   00006B   12....       LCALL   ?XSTACK_DISP0_8
   \   00006E   AA82         MOV     R2,DPL
   \   000070   AB83         MOV     R3,DPH
   \   000072   12....       LCALL   ??osal_memcpy?relay
   \   000075   7403         MOV     A,#0x3
   \   000077   12....       LCALL   ?DEALLOC_XSTACK8
   \   00007A   8017         SJMP    ??MT_AfDataRequest_2
    194              }
    195              else
    196              {
    197                dstAddr.addr.shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \                     ??MT_AfDataRequest_1:
   \   00007C   85..82       MOV     DPL,?V0 + 4
   \   00007F   85..83       MOV     DPH,?V0 + 5
   \   000082   E0           MOVX    A,@DPTR
   \   000083   FA           MOV     R2,A
   \   000084   A3           INC     DPTR
   \   000085   E0           MOVX    A,@DPTR
   \   000086   F9           MOV     R1,A
   \   000087   EA           MOV     A,R2
   \   000088   F8           MOV     R0,A
   \   000089   7402         MOV     A,#0x2
   \   00008B   12....       LCALL   ?XSTACK_DISP0_8
   \   00008E   E8           MOV     A,R0
   \   00008F   F0           MOVX    @DPTR,A
   \   000090   A3           INC     DPTR
   \   000091   E9           MOV     A,R1
   \   000092   F0           MOVX    @DPTR,A
    198              }
    199              pBuf += Z_EXTADDR_LEN;
   \                     ??MT_AfDataRequest_2:
   \   000093   E5..         MOV     A,?V0 + 4
   \   000095   2408         ADD     A,#0x8
   \   000097   F5..         MOV     ?V0 + 4,A
   \   000099   E5..         MOV     A,?V0 + 5
   \   00009B   3400         ADDC    A,#0x0
   \   00009D   F5..         MOV     ?V0 + 5,A
    200          
    201              dstAddr.endPoint = *pBuf++;
   \   00009F   85..82       MOV     DPL,?V0 + 4
   \   0000A2   F583         MOV     DPH,A
   \   0000A4   E0           MOVX    A,@DPTR
   \   0000A5   C0E0         PUSH    A
   \   0000A7   740B         MOV     A,#0xb
   \   0000A9   12....       LCALL   ?XSTACK_DISP0_8
   \   0000AC   D0E0         POP     A
   \   0000AE   F0           MOVX    @DPTR,A
   \   0000AF   85..82       MOV     DPL,?V0 + 4
   \   0000B2   85..83       MOV     DPH,?V0 + 5
   \   0000B5   A3           INC     DPTR
   \   0000B6   8582..       MOV     ?V0 + 4,DPL
   \   0000B9   8583..       MOV     ?V0 + 5,DPH
    202              dstAddr.panId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   0000BC   E0           MOVX    A,@DPTR
   \   0000BD   FA           MOV     R2,A
   \   0000BE   A3           INC     DPTR
   \   0000BF   E0           MOVX    A,@DPTR
   \   0000C0   F9           MOV     R1,A
   \   0000C1   EA           MOV     A,R2
   \   0000C2   F8           MOV     R0,A
   \   0000C3   740C         MOV     A,#0xc
   \   0000C5   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C8   E8           MOV     A,R0
   \   0000C9   F0           MOVX    @DPTR,A
   \   0000CA   A3           INC     DPTR
   \   0000CB   E9           MOV     A,R1
   \   0000CC   F0           MOVX    @DPTR,A
    203              pBuf += 2;
   \   0000CD   E5..         MOV     A,?V0 + 4
   \   0000CF   2402         ADD     A,#0x2
   \   0000D1   F5..         MOV     ?V0 + 4,A
   \   0000D3   E5..         MOV     A,?V0 + 5
   \   0000D5   3400         ADDC    A,#0x0
   \   0000D7   F5..         MOV     ?V0 + 5,A
   \   0000D9   8056         SJMP    ??MT_AfDataRequest_3
    204            }
    205            else
    206            {
    207              /* Destination address */
    208              dstAddr.addrMode = afAddr16Bit;
   \                     ??MT_AfDataRequest_0:
   \   0000DB   740A         MOV     A,#0xa
   \   0000DD   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E0   7402         MOV     A,#0x2
   \   0000E2   F0           MOVX    @DPTR,A
    209              dstAddr.addr.shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   0000E3   85..82       MOV     DPL,?V0 + 4
   \   0000E6   85..83       MOV     DPH,?V0 + 5
   \   0000E9   E0           MOVX    A,@DPTR
   \   0000EA   FA           MOV     R2,A
   \   0000EB   85..82       MOV     DPL,?V0 + 0
   \   0000EE   85..83       MOV     DPH,?V0 + 1
   \   0000F1   E0           MOVX    A,@DPTR
   \   0000F2   F9           MOV     R1,A
   \   0000F3   EA           MOV     A,R2
   \   0000F4   F8           MOV     R0,A
   \   0000F5   7402         MOV     A,#0x2
   \   0000F7   12....       LCALL   ?XSTACK_DISP0_8
   \   0000FA   E8           MOV     A,R0
   \   0000FB   F0           MOVX    @DPTR,A
   \   0000FC   A3           INC     DPTR
   \   0000FD   E9           MOV     A,R1
   \   0000FE   F0           MOVX    @DPTR,A
    210              pBuf += 2;
   \   0000FF   E5..         MOV     A,?V0 + 4
   \   000101   2402         ADD     A,#0x2
   \   000103   F5..         MOV     ?V0 + 4,A
   \   000105   E5..         MOV     A,?V0 + 5
   \   000107   3400         ADDC    A,#0x0
   \   000109   F5..         MOV     ?V0 + 5,A
    211          
    212              /* Destination endpoint */
    213              dstAddr.endPoint = *pBuf++;
   \   00010B   85..82       MOV     DPL,?V0 + 4
   \   00010E   F583         MOV     DPH,A
   \   000110   E0           MOVX    A,@DPTR
   \   000111   C0E0         PUSH    A
   \   000113   740B         MOV     A,#0xb
   \   000115   12....       LCALL   ?XSTACK_DISP0_8
   \   000118   D0E0         POP     A
   \   00011A   F0           MOVX    @DPTR,A
   \   00011B   85..82       MOV     DPL,?V0 + 4
   \   00011E   85..83       MOV     DPH,?V0 + 5
   \   000121   A3           INC     DPTR
   \   000122   8582..       MOV     ?V0 + 4,DPL
   \   000125   8583..       MOV     ?V0 + 5,DPH
    214              dstAddr.panId = 0;
   \   000128   740C         MOV     A,#0xc
   \   00012A   12....       LCALL   ?XSTACK_DISP0_8
   \   00012D   E4           CLR     A
   \   00012E   F0           MOVX    @DPTR,A
   \   00012F   A3           INC     DPTR
   \   000130   F0           MOVX    @DPTR,A
    215            }
    216          
    217            /* Source endpoint */
    218            srcEP = *pBuf++;
   \                     ??MT_AfDataRequest_3:
   \   000131   85..82       MOV     DPL,?V0 + 4
   \   000134   85..83       MOV     DPH,?V0 + 5
   \   000137   E0           MOVX    A,@DPTR
   \   000138   F9           MOV     R1,A
   \   000139   A3           INC     DPTR
   \   00013A   8582..       MOV     ?V0 + 4,DPL
   \   00013D   8583..       MOV     ?V0 + 5,DPH
    219            epDesc = afFindEndPointDesc( srcEP );
   \   000140                ; Setup parameters for call to function afFindEndPointDesc
   \   000140   12....       LCALL   ??afFindEndPointDesc?relay
   \   000143   8A..         MOV     ?V0 + 0,R2
   \   000145   8B..         MOV     ?V0 + 1,R3
   \   000147   AC..         MOV     R4,?V0 + 0
   \   000149   AD..         MOV     R5,?V0 + 1
    220          
    221            /* ClusterId */
    222            cId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   00014B   85..82       MOV     DPL,?V0 + 4
   \   00014E   85..83       MOV     DPH,?V0 + 5
   \   000151   E0           MOVX    A,@DPTR
   \   000152   FA           MOV     R2,A
   \   000153   A3           INC     DPTR
   \   000154   E0           MOVX    A,@DPTR
   \   000155   F9           MOV     R1,A
   \   000156   EA           MOV     A,R2
   \   000157   2400         ADD     A,#0x0
   \   000159   F5..         MOV     ?V0 + 2,A
   \   00015B   E4           CLR     A
   \   00015C   39           ADDC    A,R1
   \   00015D   F5..         MOV     ?V0 + 3,A
    223            pBuf +=2;
   \   00015F   E5..         MOV     A,?V0 + 4
   \   000161   2402         ADD     A,#0x2
   \   000163   F5..         MOV     ?V0 + 4,A
   \   000165   E5..         MOV     A,?V0 + 5
   \   000167   3400         ADDC    A,#0x0
   \   000169   F5..         MOV     ?V0 + 5,A
    224          
    225            /* TransId */
    226            transId = *pBuf++;
   \   00016B   85..82       MOV     DPL,?V0 + 4
   \   00016E   F583         MOV     DPH,A
   \   000170   E0           MOVX    A,@DPTR
   \   000171   C0E0         PUSH    A
   \   000173   7401         MOV     A,#0x1
   \   000175   12....       LCALL   ?XSTACK_DISP0_8
   \   000178   D0E0         POP     A
   \   00017A   F0           MOVX    @DPTR,A
   \   00017B   85..82       MOV     DPL,?V0 + 4
   \   00017E   85..83       MOV     DPH,?V0 + 5
   \   000181   A3           INC     DPTR
    227          
    228            /* TxOption */
    229            txOpts = *pBuf++;
   \   000182   E0           MOVX    A,@DPTR
   \   000183   F9           MOV     R1,A
   \   000184   A3           INC     DPTR
    230          
    231            /* Radius */
    232            radius = *pBuf++;
   \   000185   E0           MOVX    A,@DPTR
   \   000186   F8           MOV     R0,A
   \   000187   A3           INC     DPTR
    233          
    234            /* Length */
    235            tempLen = *pBuf++;
   \   000188   E0           MOVX    A,@DPTR
   \   000189   FA           MOV     R2,A
   \   00018A   A3           INC     DPTR
   \   00018B   8582..       MOV     ?V0 + 4,DPL
   \   00018E   8583..       MOV     ?V0 + 5,DPH
    236          
    237            if ( epDesc == NULL )
   \   000191   EC           MOV     A,R4
   \   000192   4D           ORL     A,R5
   \   000193   700A         JNZ     ??MT_AfDataRequest_4
    238            {
    239              retValue = afStatus_INVALID_PARAMETER;
   \   000195   85..82       MOV     DPL,?XSP + 0
   \   000198   85..83       MOV     DPH,?XSP + 1
   \   00019B   7402         MOV     A,#0x2
   \   00019D   8044         SJMP    ??MT_AfDataRequest_5
    240            }
    241            else
    242            {
    243              retValue = AF_DataRequest( &dstAddr, epDesc, cId, tempLen, pBuf, &transId, txOpts, radius );
   \                     ??MT_AfDataRequest_4:
   \   00019F                ; Setup parameters for call to function AF_DataRequest
   \   00019F   E8           MOV     A,R0
   \   0001A0   F5..         MOV     ?V0 + 0,A
   \   0001A2   78..         MOV     R0,#?V0 + 0
   \   0001A4   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001A7   7402         MOV     A,#0x2
   \   0001A9   12....       LCALL   ?XSTACK_DISP0_8
   \   0001AC   8582..       MOV     ?V0 + 0,DPL
   \   0001AF   8583..       MOV     ?V0 + 1,DPH
   \   0001B2   78..         MOV     R0,#?V0 + 0
   \   0001B4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001B7   78..         MOV     R0,#?V0 + 4
   \   0001B9   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001BC   8A..         MOV     ?V0 + 0,R2
   \   0001BE   75..00       MOV     ?V0 + 1,#0x0
   \   0001C1   78..         MOV     R0,#?V0 + 0
   \   0001C3   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001C6   78..         MOV     R0,#?V0 + 2
   \   0001C8   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001CB   740B         MOV     A,#0xb
   \   0001CD   12....       LCALL   ?XSTACK_DISP0_8
   \   0001D0   AA82         MOV     R2,DPL
   \   0001D2   AB83         MOV     R3,DPH
   \   0001D4   12....       LCALL   ??AF_DataRequest?relay
   \   0001D7   7409         MOV     A,#0x9
   \   0001D9   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001DC   E9           MOV     A,R1
   \   0001DD   85..82       MOV     DPL,?XSP + 0
   \   0001E0   85..83       MOV     DPH,?XSP + 1
   \                     ??MT_AfDataRequest_5:
   \   0001E3   F0           MOVX    @DPTR,A
    244            }
    245          
    246            if (MT_RPC_CMD_SREQ == (cmd0 & MT_RPC_CMD_TYPE_MASK))
   \   0001E4   74E0         MOV     A,#-0x20
   \   0001E6   5F           ANL     A,R7
   \   0001E7   6420         XRL     A,#0x20
   \   0001E9   700D         JNZ     ??MT_AfDataRequest_6
    247            {
    248              MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP|(uint8)MT_RPC_SYS_AF), cmd1, 1, &retValue);
   \   0001EB                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   0001EB   AC82         MOV     R4,DPL
   \   0001ED   AD83         MOV     R5,DPH
   \   0001EF   7B01         MOV     R3,#0x1
   \   0001F1   EE           MOV     A,R6
   \   0001F2   FA           MOV     R2,A
   \   0001F3   7964         MOV     R1,#0x64
   \   0001F5   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    249            }
    250          }
   \                     ??MT_AfDataRequest_6:
   \   0001F8   740E         MOV     A,#0xe
   \   0001FA   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001FD   7F06         MOV     R7,#0x6
   \   0001FF   02....       LJMP    ?BANKED_LEAVE_XDATA
    251          
    252          
    253          #if defined ( ZIGBEE_SOURCE_ROUTING )
    254          
    255          /***************************************************************************************************
    256           * @fn      MT_AfDataRequestSrcRtg
    257           *
    258           * @brief   Process AF Register command
    259           *
    260           * @param   pBuf - pointer to the received buffer
    261           *
    262           * @return  none
    263           ***************************************************************************************************/
    264          void MT_AfDataRequestSrcRtg(uint8 *pBuf)
    265          {
    266            uint8 cmdId, dataLen = 0;
    267            uint8 retValue = ZFailure;
    268            endPointDesc_t *epDesc;
    269            byte transId;
    270            afAddrType_t dstAddr;
    271            cId_t cId;
    272            byte txOpts, radius, srcEP, relayCnt;
    273            uint16 *pRelayList;
    274            uint8 i;
    275          
    276            /* parse header */
    277            cmdId = pBuf[MT_RPC_POS_CMD1];
    278            pBuf += MT_RPC_FRAME_HDR_SZ;
    279          
    280            /* Destination address */
    281            /* Initialize the panID field to zero to avoid inter-pan */
    282            osal_memset( &dstAddr, 0, sizeof(afAddrType_t) ); 
    283            dstAddr.addrMode = afAddr16Bit;
    284            dstAddr.addr.shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
    285            pBuf += 2;
    286          
    287            /* Destination endpoint */
    288            dstAddr.endPoint = *pBuf++;
    289          
    290            /* Source endpoint */
    291            srcEP = *pBuf++;
    292            epDesc = afFindEndPointDesc( srcEP );
    293          
    294            /* ClusterId */
    295            cId = BUILD_UINT16(pBuf[0], pBuf[1]);
    296            pBuf +=2;
    297          
    298            /* TransId */
    299            transId = *pBuf++;
    300          
    301            /* TxOption */
    302            txOpts = *pBuf++;
    303          
    304            /* Radius */
    305            radius = *pBuf++;
    306            
    307            /* Source route relay count */
    308            relayCnt = *pBuf++;
    309            
    310            /* Convert the source route relay list */
    311            if( (pRelayList = osal_mem_alloc( relayCnt * sizeof( uint16 ))) != NULL )
    312            {
    313              for( i = 0; i < relayCnt; i++ )
    314              {
    315                pRelayList[i]  = BUILD_UINT16( pBuf[0], pBuf[1] );
    316                pBuf += 2;
    317              }
    318            
    319              /* Data payload Length */
    320              dataLen = *pBuf++;
    321          
    322              if ( epDesc == NULL )
    323              {
    324                retValue = afStatus_INVALID_PARAMETER;
    325              }
    326              else
    327              {
    328                retValue = AF_DataRequestSrcRtg( &dstAddr, epDesc, cId, dataLen, pBuf, 
    329                                               &transId, txOpts, radius, relayCnt, pRelayList );
    330              }
    331              
    332              /* Free the memory allocated */
    333              osal_mem_free( pRelayList );
    334            }
    335            else
    336            {
    337              retValue = afStatus_MEM_FAIL;
    338            }
    339              
    340          
    341            /* Build and send back the response */
    342            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmdId, 1, &retValue);
    343          }
    344          #endif
    345          
    346          #if defined INTER_PAN
    347          /***************************************************************************************************
    348           * @fn      MT_AfInterPanCtl
    349           *
    350           * @brief   Process the AF Inter Pan control command.
    351           *
    352           * @param   pBuf - pointer to the received buffer
    353           *
    354           * @return  none
    355           ***************************************************************************************************/
    356          static void MT_AfInterPanCtl(uint8 *pBuf)
    357          {
    358            uint8 cmd, rtrn;
    359            uint16 panId;
    360            endPointDesc_t *pEP;
    361            
    362            cmd = pBuf[MT_RPC_POS_CMD1];
    363            pBuf += MT_RPC_FRAME_HDR_SZ;
    364          
    365            switch (*pBuf++)  // Inter-pan request parameter.
    366            {
    367            case InterPanClr:
    368              rtrn = StubAPS_SetIntraPanChannel();           // Switch channel back to the NIB channel.
    369              break;
    370          
    371            case InterPanSet:
    372              rtrn = StubAPS_SetInterPanChannel(*pBuf);      // Set channel for inter-pan communication.
    373              break;
    374          
    375            case InterPanReg:
    376              if ((pEP = afFindEndPointDesc(*pBuf)))
    377              {
    378                StubAPS_RegisterApp(pEP);
    379                rtrn = SUCCESS;
    380              }
    381              else
    382              {
    383                rtrn = FAILURE;
    384              }
    385              break;
    386          
    387            case InterPanChk:
    388              panId = BUILD_UINT16(pBuf[0], pBuf[1]);
    389              rtrn = (StubAPS_InterPan(panId, pBuf[2])) ? ZSuccess : ZFailure;
    390              break;
    391          
    392            default:
    393              rtrn = afStatus_INVALID_PARAMETER;
    394              break;
    395            }
    396          
    397            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmd, 1, &rtrn);
    398          }
    399          #endif
    400          
    401          /***************************************************************************************************
    402           * @fn      MT_AfDataConfirm
    403           *
    404           * @brief   Process
    405           *
    406           * @param   pBuf - pointer to the received buffer
    407           *
    408           * @return  none
    409           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    410          void MT_AfDataConfirm(afDataConfirm_t *pMsg)
   \                     MT_AfDataConfirm:
    411          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 3
   \   000004   74FD         MOV     A,#-0x3
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
    412            uint8 retArray[3];
    413          
    414            retArray[0] = pMsg->hdr.status;
   \   000009   8A82         MOV     DPL,R2
   \   00000B   8B83         MOV     DPH,R3
   \   00000D   A3           INC     DPTR
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   85..82       MOV     DPL,?XSP + 0
   \   000012   85..83       MOV     DPH,?XSP + 1
   \   000015   F0           MOVX    @DPTR,A
    415            retArray[1] = pMsg->endpoint;
   \   000016   8A82         MOV     DPL,R2
   \   000018   8B83         MOV     DPH,R3
   \   00001A   A3           INC     DPTR
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   C0E0         PUSH    A
   \   00001F   7401         MOV     A,#0x1
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   D0E0         POP     A
   \   000026   F0           MOVX    @DPTR,A
    416            retArray[2] = pMsg->transID;
   \   000027   8A82         MOV     DPL,R2
   \   000029   8B83         MOV     DPH,R3
   \   00002B   A3           INC     DPTR
   \   00002C   A3           INC     DPTR
   \   00002D   A3           INC     DPTR
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   C0E0         PUSH    A
   \   000031   7402         MOV     A,#0x2
   \   000033   12....       LCALL   ?XSTACK_DISP0_8
   \   000036   D0E0         POP     A
   \   000038   F0           MOVX    @DPTR,A
    417          
    418            /* Build and send back the response */
    419            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_AF), MT_AF_DATA_CONFIRM, 3, retArray);
   \   000039                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000039   85..82       MOV     DPL,?XSP + 0
   \   00003C   85..83       MOV     DPH,?XSP + 1
   \   00003F   AC82         MOV     R4,DPL
   \   000041   AD83         MOV     R5,DPH
   \   000043   7B03         MOV     R3,#0x3
   \   000045   7A80         MOV     R2,#-0x80
   \   000047   7944         MOV     R1,#0x44
   \   000049   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    420          }
   \   00004C   7403         MOV     A,#0x3
   \   00004E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000051   D083         POP     DPH
   \   000053   D082         POP     DPL
   \   000055   02....       LJMP    ?BRET
    421          
    422          /***************************************************************************************************
    423           * @fn          MT_AfIncomingMsg
    424           *
    425           * @brief       Process the callback subscription for AF Incoming data.
    426           *
    427           * @param       pkt - Incoming AF data.
    428           *
    429           * @return      none
    430           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    431          void MT_AfIncomingMsg(afIncomingMSGPacket_t *pMsg)
   \                     MT_AfIncomingMsg:
    432          {
   \   000000   74ED         MOV     A,#-0x13
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 19
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
    433            uint8 dataLen = pMsg->cmd.DataLength;  /* Length of the data section in the response packet */
   \   000009   EA           MOV     A,R2
   \   00000A   241F         ADD     A,#0x1f
   \   00000C   F582         MOV     DPL,A
   \   00000E   EB           MOV     A,R3
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F583         MOV     DPH,A
   \   000013   E0           MOVX    A,@DPTR
   \   000014   F5..         MOV     ?V0 + 9,A
    434            uint8 respLen = 17 + dataLen;          /* Length of the whole response packet */
   \   000016   7411         MOV     A,#0x11
   \   000018   25..         ADD     A,?V0 + 9
   \   00001A   F5..         MOV     ?V0 + 10,A
    435            uint8 cmd = MT_AF_INCOMING_MSG;
   \   00001C   75..81       MOV     ?V0 + 8,#-0x7f
    436            uint8 *pRsp, *tempPtr;
    437          
    438          #if defined INTER_PAN
    439            if (StubAPS_InterPan(pMsg->srcAddr.panId, pMsg->srcAddr.endPoint))
    440            {
    441              cmd = MT_AF_INCOMING_MSG_EXT;
    442            }
    443            else
    444          #endif
    445            if (pMsg->srcAddr.addrMode == afAddr64Bit)
   \   00001F   EA           MOV     A,R2
   \   000020   240E         ADD     A,#0xe
   \   000022   F5..         MOV     ?V0 + 4,A
   \   000024   EB           MOV     A,R3
   \   000025   3400         ADDC    A,#0x0
   \   000027   F5..         MOV     ?V0 + 5,A
   \   000029   85..82       MOV     DPL,?V0 + 4
   \   00002C   F583         MOV     DPH,A
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   6403         XRL     A,#0x3
   \   000031   7003         JNZ     ??MT_AfIncomingMsg_0
    446            {
    447              cmd = MT_AF_INCOMING_MSG_EXT;
   \   000033   75..82       MOV     ?V0 + 8,#-0x7e
    448            }
    449          
    450            if (cmd == MT_AF_INCOMING_MSG_EXT)
   \                     ??MT_AfIncomingMsg_0:
   \   000036   7482         MOV     A,#-0x7e
   \   000038   65..         XRL     A,?V0 + 8
   \   00003A   7006         JNZ     ??MT_AfIncomingMsg_1
    451            {
    452              respLen += 9;
   \   00003C   7409         MOV     A,#0x9
   \   00003E   25..         ADD     A,?V0 + 10
   \   000040   F5..         MOV     ?V0 + 10,A
    453            }
    454          
    455            // Attempt to allocate memory for the response packet.
    456            if ((pRsp = osal_mem_alloc(respLen)) == NULL)
   \                     ??MT_AfIncomingMsg_1:
   \   000042                ; Setup parameters for call to function osal_mem_alloc
   \   000042   85....       MOV     ?V0 + 2,?V0 + 10
   \   000045   AA..         MOV     R2,?V0 + 2
   \   000047   7B00         MOV     R3,#0x0
   \   000049   12....       LCALL   ??osal_mem_alloc?relay
   \   00004C   8A..         MOV     ?V0 + 2,R2
   \   00004E   8B..         MOV     ?V0 + 3,R3
   \   000050   EA           MOV     A,R2
   \   000051   45..         ORL     A,?V0 + 3
   \   000053   7003         JNZ     $+5
   \   000055   02....       LJMP    ??MT_AfIncomingMsg_2 & 0xFFFF
    457            {
    458              return;
    459            }
    460            tempPtr = pRsp;
   \   000058   AE..         MOV     R6,?V0 + 2
   \   00005A   AF..         MOV     R7,?V0 + 3
    461          
    462            /* Fill in the data */
    463          
    464            /* Group ID */
    465            *tempPtr++ = LO_UINT16(pMsg->groupId);
   \   00005C   E5..         MOV     A,?V0 + 0
   \   00005E   2402         ADD     A,#0x2
   \   000060   F8           MOV     R0,A
   \   000061   E5..         MOV     A,?V0 + 1
   \   000063   3400         ADDC    A,#0x0
   \   000065   F9           MOV     R1,A
   \   000066   8882         MOV     DPL,R0
   \   000068   8983         MOV     DPH,R1
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   8E82         MOV     DPL,R6
   \   00006D   8F83         MOV     DPH,R7
   \   00006F   F0           MOVX    @DPTR,A
   \   000070   A3           INC     DPTR
   \   000071   AE82         MOV     R6,DPL
   \   000073   AF83         MOV     R7,DPH
    466            *tempPtr++ = HI_UINT16(pMsg->groupId);
   \   000075   8882         MOV     DPL,R0
   \   000077   8983         MOV     DPH,R1
   \   000079   A3           INC     DPTR
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   8E82         MOV     DPL,R6
   \   00007D   8F83         MOV     DPH,R7
   \   00007F   F0           MOVX    @DPTR,A
   \   000080   A3           INC     DPTR
   \   000081   0E           INC     R6
   \   000082   AF83         MOV     R7,DPH
    467          
    468            /* Cluster ID */
    469            *tempPtr++ = LO_UINT16(pMsg->clusterId);
   \   000084   E5..         MOV     A,?V0 + 0
   \   000086   2404         ADD     A,#0x4
   \   000088   08           INC     R0
   \   000089   08           INC     R0
   \   00008A   E5..         MOV     A,?V0 + 1
   \   00008C   3400         ADDC    A,#0x0
   \   00008E   F9           MOV     R1,A
   \   00008F   8882         MOV     DPL,R0
   \   000091   8983         MOV     DPH,R1
   \   000093   E0           MOVX    A,@DPTR
   \   000094   8E82         MOV     DPL,R6
   \   000096   8F83         MOV     DPH,R7
   \   000098   F0           MOVX    @DPTR,A
   \   000099   A3           INC     DPTR
   \   00009A   0E           INC     R6
   \   00009B   AF83         MOV     R7,DPH
    470            *tempPtr++ = HI_UINT16(pMsg->clusterId);
   \   00009D   8882         MOV     DPL,R0
   \   00009F   8983         MOV     DPH,R1
   \   0000A1   A3           INC     DPTR
   \   0000A2   E0           MOVX    A,@DPTR
   \   0000A3   8E82         MOV     DPL,R6
   \   0000A5   8F83         MOV     DPH,R7
   \   0000A7   F0           MOVX    @DPTR,A
   \   0000A8   A3           INC     DPTR
   \   0000A9   0E           INC     R6
   \   0000AA   AF83         MOV     R7,DPH
    471          
    472            if (cmd == MT_AF_INCOMING_MSG_EXT)
   \   0000AC   A3           INC     DPTR
   \   0000AD   A983         MOV     R1,DPH
   \   0000AF   E5..         MOV     A,?V0 + 0
   \   0000B1   2406         ADD     A,#0x6
   \   0000B3   FA           MOV     R2,A
   \   0000B4   E5..         MOV     A,?V0 + 1
   \   0000B6   3400         ADDC    A,#0x0
   \   0000B8   FB           MOV     R3,A
   \   0000B9   7482         MOV     A,#-0x7e
   \   0000BB   65..         XRL     A,?V0 + 8
   \   0000BD   7072         JNZ     ??MT_AfIncomingMsg_3
    473            {
    474              *tempPtr++ = pMsg->srcAddr.addrMode;
   \   0000BF   85..82       MOV     DPL,?V0 + 4
   \   0000C2   85..83       MOV     DPH,?V0 + 5
   \   0000C5   E0           MOVX    A,@DPTR
   \   0000C6   8E82         MOV     DPL,R6
   \   0000C8   8F83         MOV     DPH,R7
   \   0000CA   F0           MOVX    @DPTR,A
   \   0000CB   0E           INC     R6
   \   0000CC   E9           MOV     A,R1
   \   0000CD   FF           MOV     R7,A
    475          
    476              if (pMsg->srcAddr.addrMode == afAddr64Bit)
   \   0000CE   85..82       MOV     DPL,?V0 + 4
   \   0000D1   85..83       MOV     DPH,?V0 + 5
   \   0000D4   E0           MOVX    A,@DPTR
   \   0000D5   6403         XRL     A,#0x3
   \   0000D7   701E         JNZ     ??MT_AfIncomingMsg_4
    477              {
    478                (void)osal_memcpy(tempPtr, pMsg->srcAddr.addr.extAddr, Z_EXTADDR_LEN);
   \   0000D9                ; Setup parameters for call to function osal_memcpy
   \   0000D9   8A..         MOV     ?V0 + 4,R2
   \   0000DB   8B..         MOV     ?V0 + 5,R3
   \   0000DD   75..00       MOV     ?V0 + 6,#0x0
   \   0000E0   78..         MOV     R0,#?V0 + 4
   \   0000E2   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000E5   7C08         MOV     R4,#0x8
   \   0000E7   7D00         MOV     R5,#0x0
   \   0000E9   EE           MOV     A,R6
   \   0000EA   FA           MOV     R2,A
   \   0000EB   EF           MOV     A,R7
   \   0000EC   FB           MOV     R3,A
   \   0000ED   12....       LCALL   ??osal_memcpy?relay
   \   0000F0   7403         MOV     A,#0x3
   \   0000F2   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000F5   8016         SJMP    ??MT_AfIncomingMsg_5
    479              }
    480              else
    481              {
    482                tempPtr[0] = LO_UINT16(pMsg->srcAddr.addr.shortAddr);
   \                     ??MT_AfIncomingMsg_4:
   \   0000F7   8A82         MOV     DPL,R2
   \   0000F9   8B83         MOV     DPH,R3
   \   0000FB   E0           MOVX    A,@DPTR
   \   0000FC   8E82         MOV     DPL,R6
   \   0000FE   8F83         MOV     DPH,R7
   \   000100   F0           MOVX    @DPTR,A
    483                tempPtr[1] = HI_UINT16(pMsg->srcAddr.addr.shortAddr);
   \   000101   8A82         MOV     DPL,R2
   \   000103   8B83         MOV     DPH,R3
   \   000105   A3           INC     DPTR
   \   000106   E0           MOVX    A,@DPTR
   \   000107   8E82         MOV     DPL,R6
   \   000109   8F83         MOV     DPH,R7
   \   00010B   A3           INC     DPTR
   \   00010C   F0           MOVX    @DPTR,A
    484              }
    485              tempPtr += Z_EXTADDR_LEN;
   \                     ??MT_AfIncomingMsg_5:
   \   00010D   EE           MOV     A,R6
   \   00010E   2408         ADD     A,#0x8
   \   000110   FE           MOV     R6,A
   \   000111   EF           MOV     A,R7
   \   000112   3400         ADDC    A,#0x0
   \   000114   FF           MOV     R7,A
    486          
    487              *tempPtr++ = pMsg->srcAddr.endPoint;
   \   000115   E5..         MOV     A,?V0 + 0
   \   000117   240F         ADD     A,#0xf
   \   000119   F582         MOV     DPL,A
   \   00011B   E5..         MOV     A,?V0 + 1
   \   00011D   3400         ADDC    A,#0x0
   \   00011F   F583         MOV     DPH,A
   \   000121   E0           MOVX    A,@DPTR
   \   000122   8E82         MOV     DPL,R6
   \   000124   8F83         MOV     DPH,R7
   \   000126   F0           MOVX    @DPTR,A
   \   000127   A3           INC     DPTR
    488          #if defined INTER_PAN
    489              *tempPtr++ = LO_UINT16(pMsg->srcAddr.panId);
    490              *tempPtr++ = HI_UINT16(pMsg->srcAddr.panId);
    491          #else
    492              *tempPtr++ = 0;
   \   000128   E4           CLR     A
   \   000129   F0           MOVX    @DPTR,A
   \   00012A   A3           INC     DPTR
    493              *tempPtr++ = 0;
   \   00012B   F0           MOVX    @DPTR,A
   \   00012C   A3           INC     DPTR
   \   00012D   0E           INC     R6
   \   00012E   0E           INC     R6
   \   00012F   802F         SJMP    ??MT_AfIncomingMsg_6
    494          #endif
    495            }
    496            else
    497            {
    498              /* Source Address */
    499              *tempPtr++ = LO_UINT16(pMsg->srcAddr.addr.shortAddr);
   \                     ??MT_AfIncomingMsg_3:
   \   000131   8A82         MOV     DPL,R2
   \   000133   8B83         MOV     DPH,R3
   \   000135   E0           MOVX    A,@DPTR
   \   000136   8E82         MOV     DPL,R6
   \   000138   8F83         MOV     DPH,R7
   \   00013A   F0           MOVX    @DPTR,A
   \   00013B   0E           INC     R6
   \   00013C   E9           MOV     A,R1
   \   00013D   FF           MOV     R7,A
    500              *tempPtr++ = HI_UINT16(pMsg->srcAddr.addr.shortAddr);
   \   00013E   8A82         MOV     DPL,R2
   \   000140   8B83         MOV     DPH,R3
   \   000142   A3           INC     DPTR
   \   000143   E0           MOVX    A,@DPTR
   \   000144   8E82         MOV     DPL,R6
   \   000146   8F83         MOV     DPH,R7
   \   000148   F0           MOVX    @DPTR,A
   \   000149   A3           INC     DPTR
   \   00014A   0E           INC     R6
   \   00014B   AF83         MOV     R7,DPH
    501          
    502              /* Source EP */
    503              *tempPtr++ = pMsg->srcAddr.endPoint;
   \   00014D   E5..         MOV     A,?V0 + 0
   \   00014F   240F         ADD     A,#0xf
   \   000151   F582         MOV     DPL,A
   \   000153   E5..         MOV     A,?V0 + 1
   \   000155   3400         ADDC    A,#0x0
   \   000157   F583         MOV     DPH,A
   \   000159   E0           MOVX    A,@DPTR
   \   00015A   8E82         MOV     DPL,R6
   \   00015C   8F83         MOV     DPH,R7
   \   00015E   F0           MOVX    @DPTR,A
   \   00015F   A3           INC     DPTR
   \                     ??MT_AfIncomingMsg_6:
   \   000160   0E           INC     R6
   \   000161   AF83         MOV     R7,DPH
    504            }
    505          
    506            /* Destination EP */
    507            *tempPtr++ = pMsg->endPoint;
   \   000163   E5..         MOV     A,?V0 + 0
   \   000165   2414         ADD     A,#0x14
   \   000167   F582         MOV     DPL,A
   \   000169   E5..         MOV     A,?V0 + 1
   \   00016B   3400         ADDC    A,#0x0
   \   00016D   F583         MOV     DPH,A
   \   00016F   E0           MOVX    A,@DPTR
   \   000170   8E82         MOV     DPL,R6
   \   000172   8F83         MOV     DPH,R7
   \   000174   F0           MOVX    @DPTR,A
   \   000175   A3           INC     DPTR
   \   000176   AE82         MOV     R6,DPL
   \   000178   AF83         MOV     R7,DPH
    508          
    509            /* WasBroadCast */
    510            *tempPtr++ = pMsg->wasBroadcast;
   \   00017A   E5..         MOV     A,?V0 + 0
   \   00017C   2415         ADD     A,#0x15
   \   00017E   F582         MOV     DPL,A
   \   000180   E5..         MOV     A,?V0 + 1
   \   000182   3400         ADDC    A,#0x0
   \   000184   F583         MOV     DPH,A
   \   000186   E0           MOVX    A,@DPTR
   \   000187   8E82         MOV     DPL,R6
   \   000189   8F83         MOV     DPH,R7
   \   00018B   F0           MOVX    @DPTR,A
   \   00018C   A3           INC     DPTR
   \   00018D   0E           INC     R6
   \   00018E   AF83         MOV     R7,DPH
    511          
    512            /* LinkQuality */
    513            *tempPtr++ = pMsg->LinkQuality;
   \   000190   E5..         MOV     A,?V0 + 0
   \   000192   2416         ADD     A,#0x16
   \   000194   F582         MOV     DPL,A
   \   000196   E5..         MOV     A,?V0 + 1
   \   000198   3400         ADDC    A,#0x0
   \   00019A   F583         MOV     DPH,A
   \   00019C   E0           MOVX    A,@DPTR
   \   00019D   8E82         MOV     DPL,R6
   \   00019F   8F83         MOV     DPH,R7
   \   0001A1   F0           MOVX    @DPTR,A
   \   0001A2   A3           INC     DPTR
   \   0001A3   0E           INC     R6
   \   0001A4   AF83         MOV     R7,DPH
    514          
    515            /* SecurityUse */
    516            *tempPtr++ = pMsg->SecurityUse;
   \   0001A6   E5..         MOV     A,?V0 + 0
   \   0001A8   2419         ADD     A,#0x19
   \   0001AA   F582         MOV     DPL,A
   \   0001AC   E5..         MOV     A,?V0 + 1
   \   0001AE   3400         ADDC    A,#0x0
   \   0001B0   F583         MOV     DPH,A
   \   0001B2   E0           MOVX    A,@DPTR
   \   0001B3   8E82         MOV     DPL,R6
   \   0001B5   8F83         MOV     DPH,R7
   \   0001B7   F0           MOVX    @DPTR,A
   \   0001B8   A3           INC     DPTR
   \   0001B9   0E           INC     R6
   \   0001BA   AF83         MOV     R7,DPH
    517          
    518            /* Timestamp */
    519            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 0);
   \   0001BC   E5..         MOV     A,?V0 + 0
   \   0001BE   241A         ADD     A,#0x1a
   \   0001C0   FA           MOV     R2,A
   \   0001C1   E5..         MOV     A,?V0 + 1
   \   0001C3   3400         ADDC    A,#0x0
   \   0001C5   FB           MOV     R3,A
   \   0001C6   8A82         MOV     DPL,R2
   \   0001C8   8B83         MOV     DPH,R3
   \   0001CA   78..         MOV     R0,#?V0 + 4
   \   0001CC   12....       LCALL   ?L_MOV_X
   \   0001CF   8E82         MOV     DPL,R6
   \   0001D1   8F83         MOV     DPH,R7
   \   0001D3   E5..         MOV     A,?V0 + 4
   \   0001D5   F0           MOVX    @DPTR,A
   \   0001D6   A3           INC     DPTR
   \   0001D7   0E           INC     R6
   \   0001D8   AF83         MOV     R7,DPH
    520            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 1);
   \   0001DA   8A82         MOV     DPL,R2
   \   0001DC   8B83         MOV     DPH,R3
   \   0001DE   78..         MOV     R0,#?V0 + 4
   \   0001E0   12....       LCALL   ?L_MOV_X
   \   0001E3   E5..         MOV     A,?V0 + 5
   \   0001E5   8E82         MOV     DPL,R6
   \   0001E7   8F83         MOV     DPH,R7
   \   0001E9   F0           MOVX    @DPTR,A
   \   0001EA   A3           INC     DPTR
   \   0001EB   0E           INC     R6
   \   0001EC   AF83         MOV     R7,DPH
    521            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 2);
   \   0001EE   8A82         MOV     DPL,R2
   \   0001F0   8B83         MOV     DPH,R3
   \   0001F2   78..         MOV     R0,#?V0 + 4
   \   0001F4   12....       LCALL   ?L_MOV_X
   \   0001F7   7410         MOV     A,#0x10
   \   0001F9   78..         MOV     R0,#?V0 + 4
   \   0001FB   12....       LCALL   ?UL_SHR
   \   0001FE   8E82         MOV     DPL,R6
   \   000200   8F83         MOV     DPH,R7
   \   000202   E5..         MOV     A,?V0 + 4
   \   000204   F0           MOVX    @DPTR,A
   \   000205   A3           INC     DPTR
   \   000206   0E           INC     R6
   \   000207   AF83         MOV     R7,DPH
    522            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 3);
   \   000209   8A82         MOV     DPL,R2
   \   00020B   8B83         MOV     DPH,R3
   \   00020D   78..         MOV     R0,#?V0 + 4
   \   00020F   12....       LCALL   ?L_MOV_X
   \   000212   7418         MOV     A,#0x18
   \   000214   78..         MOV     R0,#?V0 + 4
   \   000216   12....       LCALL   ?UL_SHR
   \   000219   8E82         MOV     DPL,R6
   \   00021B   8F83         MOV     DPH,R7
   \   00021D   E5..         MOV     A,?V0 + 4
   \   00021F   F0           MOVX    @DPTR,A
   \   000220   A3           INC     DPTR
   \   000221   0E           INC     R6
   \   000222   AF83         MOV     R7,DPH
    523          
    524            /* Transmit Sequence Number */
    525            *tempPtr++ = pMsg->cmd.TransSeqNumber;
   \   000224   E5..         MOV     A,?V0 + 0
   \   000226   241E         ADD     A,#0x1e
   \   000228   F582         MOV     DPL,A
   \   00022A   E5..         MOV     A,?V0 + 1
   \   00022C   3400         ADDC    A,#0x0
   \   00022E   F583         MOV     DPH,A
   \   000230   E0           MOVX    A,@DPTR
   \   000231   8E82         MOV     DPL,R6
   \   000233   8F83         MOV     DPH,R7
   \   000235   F0           MOVX    @DPTR,A
   \   000236   A3           INC     DPTR
    526          
    527            /* Data Length */
    528            *tempPtr++ = dataLen;
   \   000237   E5..         MOV     A,?V0 + 9
   \   000239   F0           MOVX    @DPTR,A
   \   00023A   A3           INC     DPTR
   \   00023B   0E           INC     R6
   \   00023C   0E           INC     R6
   \   00023D   AF83         MOV     R7,DPH
    529          
    530            /* Data */
    531            if (dataLen)
   \   00023F   602B         JZ      ??MT_AfIncomingMsg_7
    532            {
    533              osal_memcpy(tempPtr, pMsg->cmd.Data, dataLen);
   \   000241                ; Setup parameters for call to function osal_memcpy
   \   000241   E5..         MOV     A,?V0 + 0
   \   000243   2421         ADD     A,#0x21
   \   000245   F582         MOV     DPL,A
   \   000247   E5..         MOV     A,?V0 + 1
   \   000249   3400         ADDC    A,#0x0
   \   00024B   F583         MOV     DPH,A
   \   00024D   E0           MOVX    A,@DPTR
   \   00024E   F5..         MOV     ?V0 + 4,A
   \   000250   A3           INC     DPTR
   \   000251   E0           MOVX    A,@DPTR
   \   000252   F5..         MOV     ?V0 + 5,A
   \   000254   78..         MOV     R0,#?V0 + 4
   \   000256   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000259   85....       MOV     ?V0 + 0,?V0 + 9
   \   00025C   AC..         MOV     R4,?V0 + 0
   \   00025E   7D00         MOV     R5,#0x0
   \   000260   EE           MOV     A,R6
   \   000261   FA           MOV     R2,A
   \   000262   EF           MOV     A,R7
   \   000263   FB           MOV     R3,A
   \   000264   12....       LCALL   ??osal_memcpy?relay
   \   000267   7403         MOV     A,#0x3
   \   000269   12....       LCALL   ?DEALLOC_XSTACK8
    534            }
    535          
    536            /* Build and send back the response */
    537            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ|(uint8)MT_RPC_SYS_AF), cmd, respLen, pRsp);
   \                     ??MT_AfIncomingMsg_7:
   \   00026C                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00026C   AC..         MOV     R4,?V0 + 2
   \   00026E   AD..         MOV     R5,?V0 + 3
   \   000270   AB..         MOV     R3,?V0 + 10
   \   000272   AA..         MOV     R2,?V0 + 8
   \   000274   7944         MOV     R1,#0x44
   \   000276   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    538          
    539            /* Free memory */
    540            osal_mem_free(pRsp);
   \   000279                ; Setup parameters for call to function osal_mem_free
   \   000279   AA..         MOV     R2,?V0 + 2
   \   00027B   AB..         MOV     R3,?V0 + 3
   \   00027D   12....       LCALL   ??osal_mem_free?relay
    541          }
   \                     ??MT_AfIncomingMsg_2:
   \   000280   7F0B         MOV     R7,#0xb
   \   000282   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfCommandProcessing?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfCommandProcessing

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfRegister?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfRegister

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfDataRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfDataRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfDataConfirm?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfDataConfirm

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfIncomingMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfIncomingMsg
    542          
    543          /***************************************************************************************************
    544          ***************************************************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     MT_AfCommandProcessing             0      0      9
       -> MT_AfRegister                 0      0     18
       -> MT_AfDataRequest              0      0     18
     MT_AfDataConfirm                   3      0      3
       -> MT_BuildAndSendZToolResponse
                                        4      0      6
     MT_AfDataRequest                   1      0     46
       -> osal_memcpy                   0      0     62
       -> afFindEndPointDesc            0      0     56
       -> AF_DataRequest                0      0     74
       -> MT_BuildAndSendZToolResponse
                                        0      0     56
     MT_AfIncomingMsg                   1      0     22
       -> osal_mem_alloc                0      0     38
       -> osal_memcpy                   0      0     44
       -> osal_memcpy                   0      0     44
       -> MT_BuildAndSendZToolResponse
                                        0      0     38
       -> osal_mem_free                 0      0     38
     MT_AfRegister                      1      0     24
       -> osal_mem_alloc                0      0     30
       -> MT_BuildEndpointDesc          0      0     30
       -> afRegister                    0      0     30
       -> osal_mem_free                 0      0     30
       -> MT_BuildAndSendZToolResponse
                                        0      0     30


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     MT_AfCommandProcessing           43
     MT_AfRegister                   145
     MT_AfDataRequest                514
     MT_AfDataConfirm                 88
     MT_AfIncomingMsg                645
     ??MT_AfCommandProcessing?relay    6
     ??MT_AfRegister?relay             6
     ??MT_AfDataRequest?relay          6
     ??MT_AfDataConfirm?relay          6
     ??MT_AfIncomingMsg?relay          6

 
 1 435 bytes in segment BANKED_CODE
    30 bytes in segment BANK_RELAYS
 
 1 465 bytes of CODE memory

Errors: none
Warnings: none
